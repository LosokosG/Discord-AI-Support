---
import DashboardLayout from "../../layouts/DashboardLayout.astro";
import ServerSelector from "../../components/dashboard/ServerSelector";
import { createSupabaseServerInstance } from "../../db/supabase.server";

// SprawdÅº, czy uÅ¼ytkownik jest zalogowany
const { cookies, redirect } = Astro;

const supabase = createSupabaseServerInstance({
  cookies,
  headers: Astro.request.headers,
});

const {
  data: { user },
} = await supabase.auth.getUser();

if (!user) {
  return redirect("/auth/login");
}

// Get env variables to pass to client components
const discordClientId = import.meta.env.PUBLIC_DISCORD_CLIENT_ID || "";

// Log environment variables for debugging
console.log("ðŸ“¢ [dashboard/index] Environment variables check:", {
  PUBLIC_DISCORD_CLIENT_ID: !!import.meta.env.PUBLIC_DISCORD_CLIENT_ID,
  DISCORD_CLIENT_ID: !!import.meta.env.DISCORD_CLIENT_ID,
});

console.log("ðŸ“¢ [dashboard/index] User details:", {
  email: user.email,
  id: user.id,
  metadata: user.user_metadata,
});
---

<DashboardLayout title="Dashboard | Discord AI Support Bot">
  <div class="container mx-auto p-6">
    <ServerSelector client:load discordClientId={discordClientId} />
  </div>
</DashboardLayout>
